<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Burgersoft - Materia Prima</title>
    <link rel="stylesheet" href="estilos-header-lader-admin.css">
    <link rel="stylesheet" href="Estilos-materiaprima.css">
    <link rel="icon" href="img\icono.png" type="image/x-icon">
</head>

<body>
    <!-- SIDEBAR IZQUIERDO -->
    <div class="sidebar">
        <div class="sidebar-header">
            <img src="img/icono.png" alt="Logo Burgersoft" class="logo">
            <hr style=" border-right: 0px solid var(--color-primario); height: 40px; ">
            <h2 class="nom-local">El Oriente</h2>
        </div>

        <div class="sidebar-footer">
            <hr style="size: 2px; width: 150px; align-self: center;">
            <div class="sidebar-item">
                <a href="Config Cuenta.html">
                    <img src="img\engranaje.png" class="icono-sidebar">
                    CONFIGURACIÓN DE CUENTA
                </a>
            </div>
            <hr style="size: 2px; width: 150px; align-self: center;">
             <div class="sidebar-item admin-name" style="text-align: center;">
                <a href="#" style="text-align: center;">
                    <img src="img/usuario.png" class="icono-sidebar">
                    <span id="nombre-sidebar">Jose Orduz</span>
                </a>
            </div>

        </div>
    </div>

    <!-- CONTENIDO PRINCIPAL -->
    <div class="main-content">
        
        <!-- HEADER NAV DERECHA -->
        <nav class="header-nav">
            <hr style=" border-right: 1px solid white; height: 40px;">
            <a href="inicio_admin.html" class="nav-item">
                <img src="img\casa.png" class="icono">
                Inicio
            </a>
            <hr style=" border-right: 1px solid white; height: 40px;">
            <a href="Menu.html" class="nav-item">
                <img src="img\cena.png" class="icono">
                Menú
            </a>
            <hr style=" border-right: 1px solid white; height: 40px;">
            <a href="Ventas.html" class="nav-item">
                <img src="img\insignia.png" class="icono">
                Ventas
            </a>
            <hr style=" border-right: 1px solid white; height: 40px;">
            <a href="Materia Prima.html" class="nav-item active">
                <img src="img\tratamiento-a-base-de-hierbas.png" class="icono">
                Materia Prima
            </a>
            <hr style=" border-right: 2px solid white; height: 40px;">
            <a href="Gestion Marca.html" class="nav-item">
                <img src="img\marca-comercial.png" class="icono">
                Gestión de Marca
            </a>
            <hr style=" border-right: 2px solid white; height: 40px;">
            <a href="Promociones.html" class="nav-item">
                <img src="img\promocion.png" class="icono">
                Promociones
            </a>
            <hr style=" border-right: 2px solid white; height: 40px;">
            <a href="Burguersoft.html" class="nav-item nav-logout">
                <img src="img\cerrar-sesion.png" class="icono">
                Salir
            </a>
        </nav>

        <div class="contenedor">
    <h2>Gestión de Materia Prima</h2>

    <div class="formulario">
        <input type="text" id="nombre" placeholder="Nombre de la materia">
        <input type="text" id="tipo" placeholder="Tipo">
        <input type="number" id="valor" placeholder="Valor">
        <input type="number" id="cantidad" placeholder="Cantidad disponible">
        <input type="text" id="marca" placeholder="Marca">

        <button id="btn-guardar">Guardar</button>
    </div>

    <div class="busqueda">
        <input type="text" id="buscar" placeholder="Buscar materia...">
    </div>

    <table>
        <thead>
            <tr>
                <th>Nombre</th><th>Tipo</th><th>Valor</th>
                <th>Cantidad</th><th>Marca</th><th>Acciones</th>
            </tr>
        </thead>
        <tbody id="tabla-materia"></tbody>
    </table>
</div>
</div>

 <div id="widget-accesibilidad">
    <button id="boton-accesibilidad" title="Opciones de Accesibilidad"></button>
    <div id="menu-accesibilidad">
        <h4>Panel de Accesibilidad</h4>
        
        <div class="opcion-acc">
            <label>Tamaño de letra: <span id="val-size">100%</span></label>
            <input type="range" id="slider-size" min="80" max="150" value="100">
        </div>

        <div class="opcion-acc">
            <label>Tipo de fuente:</label>
            <select id="select-font">
                <option value="Arial, sans-serif">Predeterminada</option>
                <option value="'Courier New', monospace">Monoespaciado</option>
                <option value="'Georgia', serif">Elegante (Serif)</option>
                <option value="'OpenDyslexic', sans-serif">Lectura Fácil</option>
            </select>
        </div>

        <div class="opcion-acc">
            <button id="btn-contraste" onclick="toggleContrast()">Activar Modo Oscuro</button>
        </div>
    </div>
</div>

<link rel="stylesheet" href="accesibilidad.css">
<script src="accesibilidad.js"></script>

<script>
let editId = null; // Ahora usaremos el ID de la base de datos

document.getElementById("btn-guardar").addEventListener("click", guardar);
document.getElementById("buscar").addEventListener("input", listar);

// 1. CARGAR DATOS AL INICIAR
window.onload = listar;

async function listar() {
    const busqueda = document.getElementById("buscar").value.toLowerCase();
    const tbody = document.getElementById("tabla-materia");
    
    try {
        const res = await fetch('http://localhost:3000/materia-prima');
        const listaMateria = await res.json();
        
        tbody.innerHTML = "";

        listaMateria
            .filter(m => m.nombre_insumo.toLowerCase().includes(busqueda))
            .forEach((m) => {
                tbody.innerHTML += `
                    <tr>
                        <td>${m.nombre_insumo}</td>
                        <td>${m.unidad_medida}</td>
                        <td>${m.valor || 0}</td> 
                        <td>${m.cantidad}</td>
                        <td>${m.nombre_marca || 'Sin Marca'}</td>
                        <td>
                            <span class="accion editar" onclick="prepararEdicion(${m.id_insumo}, '${m.nombre_insumo}', '${m.unidad_medida}', ${m.cantidad}, ${m.id_marca})">Editar</span>
                            <span class="accion eliminar" onclick="eliminar(${m.id_insumo})">Eliminar</span>
                        </td>
                    </tr>
                `;
            });
    } catch (error) {
        console.error("Error al listar:", error);
    }
}

async function guardar() {
    const nombre = document.getElementById("nombre").value;
    const tipo = document.getElementById("tipo").value; // unidad_medida
    const valor = document.getElementById("valor").value;
    const cantidad = document.getElementById("cantidad").value;
    const marca = document.getElementById("marca").value; // id_marca

    if (!nombre || !tipo) return alert("Complete los datos.");

    const data = { nombre, tipo, valor, cantidad, id_marca: marca };

    let url = 'http://localhost:3000/materia-prima';
    let metodo = 'POST';

    // Si estamos editando, cambiamos la ruta y el método
    if (editId !== null) {
        url = `http://localhost:3000/materia-prima/${editId}`;
        metodo = 'PUT';
    }

    const res = await fetch(url, {
        method: metodo,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });

    if (res.ok) {
        alert(editId === null ? "Insumo guardado" : "Insumo actualizado");
        editId = null;
        limpiar();
        listar();
    }
}

async function eliminar(id) {
    if (!confirm("¿Seguro que deseas eliminarlo?")) return;
    
    const res = await fetch(`http://localhost:3000/materia-prima/${id}`, {
        method: 'DELETE'
    });

    if (res.ok) {
        listar();
    }
}

function prepararEdicion(id, nombre, tipo, cantidad, marca) {
    document.getElementById("nombre").value = nombre;
    document.getElementById("tipo").value = tipo;
    document.getElementById("cantidad").value = cantidad;
    document.getElementById("marca").value = marca;
    editId = id;
}

    //fUNCION DE LIMPIAR
function limpiar() {
    document.querySelectorAll(".formulario input").forEach(i => i.value = "");
    editId = null;
}
</script>

</body>
</html>



